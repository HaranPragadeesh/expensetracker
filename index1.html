<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Expense Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      query,
      orderBy,
      limit,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAl5Xi8Y4tWVRKTlLcZNciq441ur-G2HtM",
  authDomain: "expense-tracker-c8372.firebaseapp.com",
  projectId: "expense-tracker-c8372",
  storageBucket: "expense-tracker-c8372.firebasestorage.app",
  messagingSenderId: "564673666498",
  appId: "1:564673666498:web:1aedb175c9e455f132ca5b"
};
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ---------- Add Expense ----------
    window.addExpense = async function () {
      const amount = amountEl.value;
      const tag = tagEl.value.trim();
      const note = noteEl.value.trim();

      if (!amount || !tag) {
        alert("Amount and tag required");
        return;
      }

      await addDoc(collection(db, "expenses"), {
        amount: Number(amount),
        tag,
        note,
        createdAt: serverTimestamp()
      });

      expenseForm.reset();
    };

    // ---------- Helpers ----------
    const tagColors = {
      food: "green",
      travel: "blue",
      rent: "red",
      shopping: "purple"
    };

    function getTagClass(tag) {
      return tagColors[tag.toLowerCase()] || "gray";
    }

    function formatDate(ts) {
      return ts.toDate().toLocaleDateString("en-IN", {
        day: "numeric",
        month: "short",
        year: "numeric"
      });
    }

    function monthKey(ts) {
      return ts.toDate().toLocaleDateString("en-IN", {
        month: "long",
        year: "numeric"
      });
    }

    // ---------- Read Expenses ----------
    const q = query(
      collection(db, "expenses"),
      orderBy("createdAt", "desc"),
      limit(100)
    );

    onSnapshot(q, (snapshot) => {
      list.innerHTML = "";
      const groups = {};

      snapshot.forEach((doc) => {
        const e = doc.data();
        if (!e.createdAt) return;

        const key = monthKey(e.createdAt);
        if (!groups[key]) groups[key] = [];
        groups[key].push(e);
      });

      Object.entries(groups).forEach(([month, expenses]) => {
        const section = document.createElement("div");
        section.innerHTML = `<h3>${month}</h3>`;

        expenses.forEach((e) => {
          const card = document.createElement("div");
          card.className = "card";

          card.innerHTML = `
            <div class="row">
              <div class="amount">â‚¹${e.amount.toFixed(2)}</div>
              <span class="tag ${getTagClass(e.tag)}">${e.tag}</span>
            </div>
            <div class="meta">
              <span>${formatDate(e.createdAt)}</span>
            </div>
            ${e.note ? `<div class="note">${e.note}</div>` : ""}
          `;

          section.appendChild(card);
        });

        list.appendChild(section);
      });
    });

    // ---------- Dark Mode ----------
    window.toggleTheme = function () {
      document.body.classList.toggle("dark");
      localStorage.theme = document.body.classList.contains("dark") ? "dark" : "light";
    };

    if (localStorage.theme === "dark") {
      document.body.classList.add("dark");
    }

    // ---------- DOM ----------
    const amountEl = document.getElementById("amount");
    const tagEl = document.getElementById("tag");
    const noteEl = document.getElementById("note");
    const expenseForm = document.getElementById("expense-form");
    const list = document.getElementById("expense-list");
  </script>

  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --text: #111;
      --muted: #666;
    }

    body.dark {
      --bg: #0f172a;
      --card: #1e293b;
      --text: #f1f5f9;
      --muted: #94a3b8;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui;
      padding: 1rem;
    }

    .app {
      max-width: 420px;
      margin: auto;
    }

    h1 {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    button {
      padding: 0.6rem;
      border-radius: 8px;
      border: none;
      background: #4f46e5;
      color: white;
      font-weight: 600;
    }

    input {
      width: 100%;
      padding: 0.6rem;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .card {
      background: var(--card);
      padding: 0.8rem;
      border-radius: 12px;
      margin-bottom: 0.6rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .amount {
      font-size: 1.2rem;
      font-weight: 700;
    }

    .tag {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
    }

    .green { background: #16a34a; }
    .blue { background: #2563eb; }
    .red { background: #dc2626; }
    .purple { background: #7c3aed; }
    .gray { background: #6b7280; }

    .note {
      margin-top: 0.3rem;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .meta {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 0.2rem;
    }
  </style>
</head>
<body>

<div class="app">
  <h1>
    Expenses
    <button onclick="toggleTheme()">ðŸŒ™</button>
  </h1>

  <div class="card">
    <form id="expense-form" onsubmit="event.preventDefault(); addExpense();">
      <input id="amount" type="number" placeholder="Amount (â‚¹)" step="0.01" />
      <input id="tag" placeholder="Tag (Food, Rent, Travel)" />
      <input id="note" placeholder="Note (optional)" />
      <button type="submit">Add Expense</button>
    </form>
  </div>

  <div id="expense-list"></div>
</div>

</body>
</html>